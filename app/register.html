<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>小米账号-登录</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/register.css">
</head>

<body>
    <!-- 头部 -->
    <section id="header_wrap">
        <section class="header content">
            <div class="logo">
                <h1><a href=""></a></h1>
            </div>
        </section>
    </section>
    <!-- <div class="banner">
            <img class="img" src="images/register/banner.jpg" alt="">
    </div> -->
    <!-- 表单 -->
    <section id="register_wrap">
        <section class="register content clearfix">
            <div class="regForm">
                <div class="tabs">
                    <a href="" class="left f56">账号登录</a>
                    <span></span>
                    <a href="" class="right">扫码登录</a>
                </div>
                <div class="regInp">
                    <form action="" class="form_wrap">
                        <input type="text" autocomplete="off" name="username" placeholder="邮箱/手机号码/小米ID">
                        <p class="user_ts" style="color:red;font-size:14px;display:none">用户名不合法,请从新输入</p>
                        <p class="fo_ts" style="color:blue;font-size:14px;display:none">请输入用户名，4-14位之间，由字母和数字组成</p>
                        <input type="password" name="pwd" placeholder="密码">
                        <p class="pwd_ts" style="color:red;font-size:14px;display:none">密码不正确,请从新输入</p>
                        <p class="mm_ts" style="color:blue;font-size:14px;display:none">请输入密码，8-16位的大小字母和数字，非空字符</p>
                        <input type="submit" class="btn" value="登录">
                        <p class="clearfix">
                            <span style="margin-right:100px"><a href="">手机短信登录/注册</a></span>
                            <span>
                                <a href="login.html">立即注册</a> | <a href="">忘记密码？</a>
                            </span>
                        </p>
                    </form>
                    <div class="fie">
                        <fieldset class="tit">
                            <legend align="center" class="oth">其他方式登录</legend>
                        </fieldset>
                        <ul>
                            <li><a href=""><i class="icons_type"></i></a></li>
                            <li><a href=""><i class="icons_type"></i></a></li>
                            <li><a href=""><i class="icons_type"></i></a></li>
                            <li><a href=""><i class="icons_type"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="saoma">
                    <img class="ewm" src="images/register/download.png" alt="">
                    <p>使用 <span>小米商城APP</span> 扫一扫</p>
                    <p>小米手机可打开「设置」>「小米帐号」扫码登录</p>
                </div>
            </div>
        </section>
    </section>
    <!-- 底部 -->
    <footer>
        <p>
            <a href="">简体</a> | <a href="">繁体</a> | <a href="">English</a> | <a href="">常见问题</a> | <a href="">隐私政策</a>
        </p>
        <p>小米公司版权所有-京ICP备10046444-<img src="images/register/ghs.png" alt=""> 京公网安备11010802020134号-京ICP证110507号</p>
    </footer>
    <script src="js/ajax.js"></script>
    <script>
        class None{
            constructor(){
                this.left = document.querySelector('.left');
                this.right = document.querySelector('.right');
                this.saoma = document.querySelector('.saoma')
                this.regInp = document.querySelector('.regInp')
            }
            event(){
                var _this= this;
                this.right.onclick = function(e){
                    e = e || event;
                    e.stopPropagation();
                    e.preventDefault();
                    _this.regInp.style.display = 'none';
                    _this.saoma.style.display = 'block';
                    _this.left.className = '';
                    _this.right.className = 'f56';
                }
                var _this= this;
                this.left.onclick = function(e){
                    e = e || event;
                    e.stopPropagation();
                    e.preventDefault();
                    _this.regInp.style.display = 'block';
                    _this.saoma.style.display = 'none';
                    _this.left.className = 'f56';
                    _this.right.className = '';
                }
            }
        }
        class Reg {
            constructor() {
                this.form = document.querySelector('.form_wrap');
                this.user = this.form['username'];
                this.pwd = this.form['pwd'];
            }
            init() {
               this.ajax();
               this.ister();
            }
            ister(){
                var _this = this;
                var userFlag = false;
                var pwdFlag = false;
                var fo_ts = document.querySelector('.fo_ts');
                var btn = document.querySelector('.btn');
                var user_ts = document.querySelector('.user_ts');
                var uNameReg = /^([\u4e00-\u9fa5]|[a-zA-Z0-9]){2,14}$/;
                var pwdReg = /^[a-zA-Z0-9]{6,16}$/;
                var pwd_ts = document.querySelector('.pwd_ts');
                var mm_ts = document.querySelector('.mm_ts');
                this.user.onfocus = function(){
                    fo_ts.style.display = "block";
                    user_ts.style.display = "none";
                }
                this.user.onblur = function(){
                    fo_ts.style.display = "none";
                    if(checkUserName()){
                          userFlag = true;
                       
                    }else{
                        user_ts.style.display = "block";
                    }
                }
                function checkUserName(){
                    var uVal = _this.user.value;
                    if(uNameReg.test(uVal)){
                        return true;
                    }
                    return false;
                }
                this.pwd.onfocus=function(){
                    mm_ts.style.display = "block";
                    pwd_ts.style.display = "none";
                       
                }
                this.pwd.onblur=function(){
                    mm_ts.style.display = "none";
                    if(checkPwd()){
                        pwdFlag = true;
                    }else{
                        pwd_ts.style.display = "block";
                    }
                }
                function checkPwd(){
                    var pVal = _this.pwd.value;
                    if(pwdReg.test(pVal)){
                        return true;
                    }
                    return false;
                }
                btn.onsubmit = function(e){
                     e = e || event;
                     e.preventDefault();
                    // if(userFlag && pwdFlag){
                    //     return true;
                    // }else{

                    //     return false;
                    // }
                }
                
            }
            ajax() {
                var $form_wrap = document.querySelector('.form_wrap');
                var $btn = document.querySelector('.btn');
                $btn.onclick = function (e) {
                    e = e || event;
                    e.preventDefault();
                    sendAjax('php/register.php', {
                        type: 'POST',
                        data: {
                            username: $form_wrap['username'].value,
                            pwd: $form_wrap['pwd'].value,
                        },
                        success(data) {
                            console.log(data);
                            let {
                                code,
                                msg,
                                data: _data
                            } = JSON.parse(data);
                            if (code == 200) {
                                //    var username = _data.name;
                                // if()
                                localStorage.name = _data.name;
                                location.href = 'wo.html?name=' + localStorage.name;
                            } else {
                                alert(msg);
                            }
                        }
                    })
                }
            }
        }
        window.onload = function(){
            new Reg().init();
            new None().event();
        }
    </script>
</body>

</html>